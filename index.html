
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Doctors Drug Prescription System</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      background: #f0f4f8;
      display: flex;
    }
    .sidebar {
      width: 280px;
      background: #007BFF;
      color: white;
      height: 100vh;
      padding: 16px;
      box-sizing: border-box;
      overflow-y: auto;
      transition: transform 0.3s ease;
      transform: translateX(-100%);
      position: fixed;
      z-index: 999;
    }
    .sidebar.visible {
      transform: translateX(0);
    }
    .sidebar h3 {
      margin: 0 0 10px 0;
    }
    .sidebar .actions {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }
    .sidebar button.small {
      width: 100%;
      padding: 8px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      background: rgba(255,255,255,0.2);
      color: #fff;
      font-weight: 600;
    }
    .sidebar .search {
      width: 100%;
      padding: 8px;
      border: none;
      border-radius: 6px;
      margin-bottom: 10px;
    }
    .sidebar ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .sidebar li {
      margin-bottom: 10px;
      font-size: 13px;
      padding: 8px;
      border-radius: 6px;
      background: rgba(255,255,255,0.12);
      cursor: pointer;
    }
    .container {
      flex: 1;
      max-width: 640px;
      margin: 0 auto;
      padding: 20px;
      background: white;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      margin-top: 40px;
      border-radius: 10px;
      position: relative;
      z-index: 1;
    }
    h2 {
      text-align: center;
      color: #007BFF;
    }
    input, select, textarea, button {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-sizing: border-box;
    }
    textarea { min-height: 90px; }
    button {
      background: #007BFF;
      color: white;
      font-weight: bold;
      cursor: pointer;
      border: none;
    }
    button:hover { opacity: 0.95; }
    .reset {
      background: #f44336;
      margin-top: 5px;
    }
    .login, .form-section {
      display: none;
    }
    .visible-section {
      display: block;
    }
    .toggle-history {
      position: fixed;
      top: 10px;
      left: 10px;
      background: #007BFF;
      color: white;
      padding: 6px 10px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      z-index: 1000;
      display: none;
    }
    .modal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1001;
      padding: 10px;
      box-sizing: border-box;
    }
    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 10px;
      width: 100%;
      max-width: 720px;
      position: relative;
    }
    .modal-content .btn-group {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 20px;
    }
    .close-btn {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 20px;
      cursor: pointer;
      color: red;
    }
    .muted {
      color: #666;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <button class="toggle-history" id="toggleHistoryBtn" onclick="toggleSidebar()">üìÅ History</button>

  <div class="sidebar" id="sidebar">
    <h3>Prescription History</h3>
    <div class="actions">
      <button class="small" onclick="clearHistory()">Clear History</button>
    </div>
    <input class="search" id="historySearch" placeholder="Search patient or illness..." oninput="renderHistory()">
    <ul id="historyList"></ul>
  </div>

  <div class="container login visible-section" id="loginSection">
    <h2>Doctor Login System</h2>
    <input type="text" id="username" placeholder="Username" />
    <input type="password" id="password" placeholder="Password" />
    <button onclick="login()">Login</button>
  </div>

  <div class="container form-section" id="formSection">
    <h2>üíä Patient Prescription Form</h2>
    <div class="muted" id="loggedInAs"></div>
    <input type="text" id="patientName" placeholder="Patient Name" />
    <select id="patientAge">
      <option value="">Select Age</option>
    </select>
    <select id="illness">
      <option value="">Select Illness</option>
    </select>
    <input type="number" id="days" placeholder="Days of Sickness" min="0" />
    <textarea id="symptoms" placeholder="Additional Symptoms (e.g. fever, cough). Separate by comma or space."></textarea>
    <button onclick="generatePrescription()">Prescribe</button>
    <button class="reset" onclick="resetForm()">Reset</button>
  </div>

  <div class="modal" id="modal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal()">&times;</span>
      <div id="output"></div>
      <div class="btn-group">
        <button onclick="sharePrescription()">Share</button>
        <button onclick="printPrescription()">Print</button>
      </div>
    </div>
  </div>

  <script>
  // ************** AUTH **************
  let doctorName = "";

  const validDoctors = {
    "Dr. Seker": "S123",
    "Dr. Malu":  "M123",
    "Dr. Belo":  "B123"
  };

  function login() {
    const user = document.getElementById("username").value.trim();
    const pass = document.getElementById("password").value.trim();

    if (validDoctors[user] && validDoctors[user] === pass) {
      doctorName = user;
      document.getElementById("loginSection").classList.remove("visible-section");
      document.getElementById("formSection").classList.add("visible-section");
      document.getElementById("toggleHistoryBtn").style.display = "block";
      document.getElementById("loggedInAs").textContent = "Logged in as: " + doctorName;
      renderHistory(); // show any existing history
    } else {
      alert("Invalid username or password. Only authorized doctors can log in.");
    }
  }

  // ************** SELECT DATA **************
  const ages = Array.from({ length: 100 }, (_, i) => i + 1);
  const ageSelect = document.getElementById("patientAge");
  ages.forEach(age => {
    const opt = document.createElement("option");
    opt.value = age;
    opt.textContent = age;
    ageSelect.appendChild(opt);
  });


const illnessData = [
  { condition: "Malaria",
    drugs: ["Artemether", "Lumefantrine"],
    prescription: "Artemether/Lumefantrine 20/120mg, 4 tablets twice daily for 3 days",
    diet: ["Plenty of fluids", "Fruits", "Light meals"]
  },
  { condition: "Typhoid",
    drugs: ["Ciprofloxacin", "Paracetamol"],
    prescription: "Ciprofloxacin 500mg twice daily for 7 days; Paracetamol 500mg for fever as needed",
    diet: ["Boiled foods", "Hydration", "Avoid spicy meals"]
  },
  { condition: "Asthma",
    drugs: ["Salbutamol inhaler", "Prednisolone"],
    prescription: "Use Salbutamol inhaler 2 puffs every 6 hours as needed; Prednisolone as directed",
    diet: ["Avoid allergens", "Eat omega-3 rich foods"]
  },
  { condition: "Diabetes",
    drugs: ["Metformin", "Insulin glargine"],
    prescription: "Metformin 500mg twice daily; adjust insulin as prescribed",
    diet: ["Low sugar", "High fiber diet"]
  },
  { condition: "Hypertension",
    drugs: ["Lisinopril", "Amlodipine"],
    prescription: "Lisinopril 10mg once daily; Amlodipine 5mg once daily",
    diet: ["Low salt", "More vegetables"]
  },
  { condition: "Ulcer",
    drugs: ["Omeprazole", "Aluminium hydroxide antacid"],
    prescription: "Omeprazole 20mg once daily before breakfast for 14 days",
    diet: ["No spicy food", "Frequent small meals"]
  },
  { condition: "Hepatitis B",
    drugs: ["Tenofovir disoproxil", "Entecavir"],
    prescription: "Tenofovir 300mg once daily or Entecavir 0.5mg daily as directed",
    diet: ["Low-fat diet", "Plenty of fruits"]
  },
  { condition: "COVID-19",
    drugs: ["Paracetamol", "Vitamin C", "Zinc"],
    prescription: "Paracetamol 500mg every 6 hours for fever; supportive care",
    diet: ["Fruits", "Plenty of rest", "Hydration"]
  },
  { condition: "Tuberculosis",
    drugs: ["Rifampicin", "Isoniazid", "Pyrazinamide", "Ethambutol"],
    prescription: "Standard 4-drug TB therapy for 2 months, then 2-drug continuation for 4 months",
    diet: ["High protein", "Vitamin supplements"]
  },
  { condition: "Pneumonia",
    drugs: ["Azithromycin", "Amoxicillin"],
    prescription: "Azithromycin 500mg once daily for 3 days or Amoxicillin 500mg three times daily for 7 days",
    diet: ["Warm fluids", "Soft food"]
  },
  { condition: "Anemia",
    drugs: ["Ferrous sulfate", "Folic acid"],
    prescription: "Ferrous sulfate 325mg once or twice daily; Folic acid 5mg daily",
    diet: ["Iron-rich foods", "Vegetables", "Vitamin C"]
  },
  { condition: "Arthritis",
    drugs: ["Ibuprofen", "Methotrexate (if chronic)"],
    prescription: "Ibuprofen 400mg every 8 hours with food; Disease-modifying drugs as prescribed",
    diet: ["Low salt", "High protein", "Fruits"]
  },
  { condition: "Cataract",
    drugs: ["Topical NSAID eye drops", "Antibiotic eye drops (post-op)"],
    prescription: "Eye drops as directed after surgery",
    diet: ["Balanced diet", "Omega-3"]
  },
  { condition: "Glaucoma",
    drugs: ["Timolol eye drops", "Latanoprost"],
    prescription: "Timolol 1 drop twice daily; Latanoprost 1 drop at night",
    diet: ["Vegetables", "Avoid high caffeine"]
  },
  { condition: "Sinusitis",
    drugs: ["Amoxicillin-clavulanate", "Nasal saline"],
    prescription: "Amoxicillin-clavulanate 875/125mg twice daily for 7-10 days",
    diet: ["Warm fluids", "Fruits"]
  },
  { condition: "Tonsillitis",
    drugs: ["Penicillin V", "Ibuprofen"],
    prescription: "Penicillin V 500mg every 6 hours for 10 days; Ibuprofen for pain",
    diet: ["Soft foods", "Hydration"]
  },
  { condition: "Appendicitis",
    drugs: ["Ceftriaxone", "Metronidazole (pre/post-op)"],
    prescription: "IV antibiotics as per surgical protocol",
    diet: ["Nil by mouth pre-op; balanced after recovery"]
  },
  { condition: "Hernia",
    drugs: ["Analgesics (e.g., Paracetamol)"],
    prescription: "Pain relief as required; surgical repair is definitive",
    diet: ["Light meals post-op", "Hydration"]
  },
  { condition: "Depression",
    drugs: ["Fluoxetine", "Sertraline"],
    prescription: "Fluoxetine 20mg daily or Sertraline 50mg daily",
    diet: ["Balanced diet", "Omega-3"]
  },
  { condition: "Anxiety",
    drugs: ["Buspirone", "Escitalopram"],
    prescription: "Buspirone 10mg twice daily or Escitalopram 10mg daily",
    diet: ["Fruits", "Hydration"]
  },
  { condition: "Insomnia",
    drugs: ["Zolpidem", "Melatonin"],
    prescription: "Zolpidem 5-10mg at bedtime; Melatonin as needed",
    diet: ["Light evening meals", "Avoid caffeine"]
  },
  { condition: "Allergy",
    drugs: ["Loratadine", "Cetirizine"],
    prescription: "Loratadine 10mg once daily or Cetirizine 10mg once daily",
    diet: ["Avoid allergens", "Hydration"]
  },
  { condition: "Eczema",
    drugs: ["Topical corticosteroid cream", "Moisturizer"],
    prescription: "Apply topical steroids as prescribed; moisturize frequently",
    diet: ["Balanced diet", "Omega-3"]
  },
  { condition: "Psoriasis",
    drugs: ["Topical corticosteroid", "Methotrexate (systemic)"],
    prescription: "Topical therapy for mild; systemic therapy if severe",
    diet: ["Low fat", "Hydration"]
  },
  { condition: "Gonorrhea",
    drugs: ["Ceftriaxone"],
    prescription: "Ceftriaxone 500mg intramuscular single dose",
    diet: ["Hydration", "Fruits"]
  },
  { condition: "Syphilis",
    drugs: ["Benzathine penicillin G"],
    prescription: "Benzathine penicillin G 2.4 million units intramuscular single dose",
    diet: ["Hydration", "Low salt"]
  },
  { condition: "UTI",
    drugs: ["Nitrofurantoin", "Cefuroxime"],
    prescription: "Nitrofurantoin 100mg twice daily for 5 days",
    diet: ["Hydration", "Vegetables"]
  },
  { condition: "Kidney Stones",
    drugs: ["Tamsulosin", "Pain relief (Ibuprofen)"],
    prescription: "Tamsulosin 0.4mg once daily; analgesics as needed",
    diet: ["Plenty of fluids", "Low salt"]
  },
  { condition: "Prostate Enlargement",
    drugs: ["Tamsulosin", "Finasteride"],
    prescription: "Tamsulosin 0.4mg daily; Finasteride 5mg daily",
    diet: ["Vegetables", "Hydration"]
  },
  { condition: "Menstrual Pain",
    drugs: ["Ibuprofen", "Mefenamic acid"],
    prescription: "Ibuprofen 400mg every 8 hours as needed",
    diet: ["Warm fluids", "Fruits"]
  },
  { condition: "Fibroids",
    drugs: ["Tranexamic acid", "Leuprolide (if severe)"],
    prescription: "Tranexamic acid during heavy bleeding; surgical referral if indicated",
    diet: ["Balanced diet", "Hydration"]
  },
  { condition: "Ovarian Cyst",
    drugs: ["Analgesics", "Hormonal therapy (as advised)"],
    prescription: "Pain relief and hormonal therapy if indicated",
    diet: ["Fiber-rich meals", "Fruits"]
  },
  { condition: "Ear Infection",
    drugs: ["Amoxicillin", "Ofloxacin ear drops"],
    prescription: "Amoxicillin 500mg three times daily for 7 days; ear drops as directed",
    diet: ["Hydration", "Soft foods"]
  },
  { condition: "Toothache",
    drugs: ["Ibuprofen", "Amoxicillin (if infection)"],
    prescription: "Ibuprofen 400mg as needed; Amoxicillin 500mg three times daily for infection",
    diet: ["Soft foods", "Warm fluids"]
  },
  { condition: "Obesity",
    drugs: ["Orlistat"],
    prescription: "Orlistat 120mg three times daily with meals",
    diet: ["Low fat", "High fiber"]
  },
  { condition: "Back Pain",
    drugs: ["Ibuprofen", "Paracetamol"],
    prescription: "Ibuprofen 400mg every 8 hours with food",
    diet: ["Balanced meals", "Hydration"]
  },
  { condition: "Scabies",
    drugs: ["Permethrin cream"],
    prescription: "Apply Permethrin cream overnight and repeat in 7 days",
    diet: ["Balanced diet"]
  },
  { condition: "Ringworm",
    drugs: ["Clotrimazole cream"],
    prescription: "Apply Clotrimazole twice daily for 2-4 weeks",
    diet: ["Balanced diet"]
  }
];  

  const illnessSelect = document.getElementById("illness");
  illnessData.forEach(entry => {
    const opt = document.createElement("option");
    opt.value = entry.condition;
    opt.textContent = entry.condition;
    illnessSelect.appendChild(opt);
  });

  // ************** SYMPTOM SUPPORT **************
  const symptomSupport = {
    fever: { drugs: ["Paracetamol"], prescription: "500mg every 6 hours" },
    cold: { drugs: ["Vitamin C"], prescription: "1000mg daily" },
    headache: { drugs: ["Ibuprofen"], prescription: "200mg every 8 hours" },
    cough: { drugs: ["Cough Syrup"], prescription: "10ml twice a day" },
    sorethroat: { drugs: ["Lozenges"], prescription: "One every 4 hours" },
    vomiting: { drugs: ["Ondansetron"], prescription: "4mg every 8 hours" },
    fatigue: { drugs: ["Multivitamins"], prescription: "One daily" },
    highbodytemperature: { drugs: ["Acetaminophen"], prescription: "500mg every 4-6 hours" },
    shortnessofbreath: { drugs: ["Bronchodilator"], prescription: "As directed" },
    nausea: { drugs: ["Domperidone"], prescription: "10mg before meals" },
    diarrhea: { drugs: ["ORS", "Loperamide"], prescription: "As directed" },
    jointpain: { drugs: ["Diclofenac"], prescription: "50mg twice daily" },
    chestpain: { drugs: ["Aspirin (low dose)"], prescription: "75mg daily (consult doctor)" },
    rash: { drugs: ["Antihistamine Cream"], prescription: "Apply twice daily" },
    dizziness: { drugs: ["Meclizine"], prescription: "25mg as needed" }
  };

  // ************** HISTORY (PERSISTENT) **************
  const HISTORY_KEY = "prescriptionHistory";
  let prescriptionHistory = JSON.parse(localStorage.getItem(HISTORY_KEY)) || [];

  function saveHistory() {
    localStorage.setItem(HISTORY_KEY, JSON.stringify(prescriptionHistory));
  }

  function clearHistory() {
    if (confirm("Are you sure you want to clear all prescription history?")) {
      prescriptionHistory = [];
      saveHistory();
      renderHistory();
    }
  }

  function renderHistory() {
    const historyList = document.getElementById("historyList");
    const q = (document.getElementById("historySearch")?.value || "").toLowerCase().trim();
    historyList.innerHTML = "";

    const filtered = prescriptionHistory.filter(r =>
      !q ||
      r.patient.toLowerCase().includes(q) ||
      r.illness.toLowerCase().includes(q)
    );

    if (filtered.length === 0) {
      const empty = document.createElement("li");
      empty.textContent = "No history yet.";
      empty.style.opacity = "0.8";
      historyList.appendChild(empty);
      return;
    }

    filtered.forEach((item, index) => {
      const li = document.createElement("li");
      li.innerHTML = `<strong>${item.patient}</strong> ‚Äî ${item.illness}<br>
        <span style="opacity:.85">By ${item.doctor} ¬∑ ${item.date}</span>`;
      li.onclick = () => showRecord(item);
      historyList.appendChild(li);
    });
  }

  function addToHistory(record) {
    prescriptionHistory.push(record);
    saveHistory();
    renderHistory();
  }

  function showRecord(record) {
    const result = `
      <p><strong>Patient:</strong> ${record.patient}</p>
      <p><strong>Age:</strong> ${record.age}</p>
      <p><strong>Illness:</strong> ${record.illness}</p>
      <p><strong>Days Sick:</strong> ${record.days} days</p>
      <p><strong>Symptoms:</strong> ${record.symptoms.join(", ") || "None"}</p>
      <hr>
      <p><strong>Drugs:</strong> ${record.drugs.join(", ")}</p>
      <p><strong>Prescription:</strong><br>${record.prescription.replace(/\n/g,"<br>")}</p>
      <p><strong>Recommended Diet:</strong> ${record.diet.join(", ")}</p>
      <hr>
      <p class="muted">Created on ${record.date}</p>
      <p><strong>Signed ‚úçÔ∏è by:</strong> ${record.doctor}</p>
    `;
    document.getElementById("output").innerHTML = result;
    document.getElementById("modal").style.display = "flex";
  }

  // ************** PRESCRIPTION GENERATION **************
  function generatePrescription() {
    const name = document.getElementById("patientName").value.trim();
    const age = document.getElementById("patientAge").value;
    const illness = document.getElementById("illness").value;
    const days = document.getElementById("days").value;
    const rawSymptoms = document.getElementById("symptoms").value.trim().toLowerCase();

    if (!name || !age || !illness || !days) {
      alert("Please fill Patient Name, Age, Illness, and Days of Sickness.");
      return;
    }

    const symptoms = rawSymptoms
      ? rawSymptoms.split(/[\s,]+/).filter(Boolean)
      : [];

    const data = illnessData.find(entry => entry.condition === illness);
    let extraDrugs = [], extraPrescriptions = [];

    symptoms.forEach(symptom => {
      if (symptomSupport[symptom]) {
        extraDrugs = extraDrugs.concat(symptomSupport[symptom].drugs);
        extraPrescriptions.push(`${symptomSupport[symptom].drugs.join(", ")}: ${symptomSupport[symptom].prescription}`);
      }
    });

    if (!data) {
      alert("No data found for selected illness.");
      return;
    }

    const combinedDrugs = [...data.drugs, ...extraDrugs];
    const fullPrescriptionLines = [data.prescription, ...extraPrescriptions].filter(Boolean);
    const fullPrescriptionText = fullPrescriptionLines.join("\n");
    const resultHtml = `
      <p><strong>Patient:</strong> ${name}</p>
      <p><strong>Age:</strong> ${age}</p>
      <p><strong>Illness:</strong> ${illness}</p>
      <p><strong>Days Sick:</strong> ${days} days</p>
      <p><strong>Symptoms:</strong> ${symptoms.join(", ") || "None"}</p>
      <hr>
      <p><strong>Drugs:</strong> ${combinedDrugs.join(", ")}</p>
      <p><strong>Prescription:</strong><br>${fullPrescriptionLines.join("<br>")}</p>
      <p><strong>Recommended Diet:</strong> ${data.diet.join(", ")}</p>
      <hr>
      <p><strong>Signed ‚úçÔ∏è by:</strong> ${doctorName}</p>
    `;

    document.getElementById("output").innerHTML = resultHtml;
    document.getElementById("modal").style.display = "flex";

    const record = {
      doctor: doctorName,
      patient: name,
      age: age,
      illness: illness,
      days: days,
      symptoms: symptoms,
      drugs: combinedDrugs,
      prescription: fullPrescriptionText,
      diet: data.diet,
      date: new Date().toLocaleString()
    };
    addToHistory(record);
  }

  // ************** UTILITIES **************
  function resetForm() {
    document.getElementById("patientName").value = "";
    document.getElementById("patientAge").value = "";
    document.getElementById("illness").value = "";
    document.getElementById("days").value = "";
    document.getElementById("symptoms").value = "";
    document.getElementById("output").innerHTML = "";
  }

  function closeModal() {
    document.getElementById("modal").style.display = "none";
  }

  function sharePrescription() {
    const result = document.getElementById("output").innerText;
    if (navigator.share) {
      navigator.share({ title: "Prescription", text: result });
    } else {
      navigator.clipboard.writeText(result);
      alert("Prescription copied to clipboard!");
    }
  }

  function printPrescription() {
    const content = document.getElementById("output").innerHTML;
    const printWindow = window.open('', '', 'height=600,width=800');
    printWindow.document.write('<html><head><title>Print Prescription</title></head><body>');
    printWindow.document.write(content);
    printWindow.document.write('</body></html>');
    printWindow.document.close();
    printWindow.print();
  }

  function toggleSidebar() {
    document.getElementById("sidebar").classList.toggle("visible");
  }

  // Initial render of history (in case user opens before login)
  renderHistory();
  </script>
</body>
</html>
